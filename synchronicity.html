<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Synchronicity Reader</title>
<style>
  :root{ --bg:#05090a; --card:#081215; --edge:#102227; --text:#d1f7ff; --mint:#7efcff; --muted:#9bc7d1; --ok:#a7ffd8; --err:#ff9b9b }
  *{box-sizing:border-box} html,body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif}
  .wrap{max-width:1000px;margin:0 auto;padding:22px 16px 40px}
  h1{margin:0 0 6px;color:var(--mint)}
  .sub{margin:0 0 16px;color:var(--muted)}
  .card{background:var(--card);border:1px solid var(--edge);border-radius:14px;padding:16px;margin:14px 0}
  .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
  .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px}
  .kpi{background:#0b1214;border:1px solid var(--edge);border-radius:10px;padding:12px}
  .kpi h3{margin:0 0 6px;color:var(--mint);font-size:15px}
  .kpi div{font-weight:700;font-size:20px;font-family:ui-monospace,Menlo,Consolas,monospace}
  label{font-weight:600;display:block;margin:.4rem 0 .2rem}
  input,button{font:inherit;border-radius:10px;border:1px solid var(--edge);background:#0b1214;color:var(--text);padding:.55rem .7rem}
  button{cursor:pointer}
  .chip{display:inline-block;border:1px solid #1f3b41;border-radius:999px;padding:4px 8px;margin:4px 6px 0 0;color:#9bc7d1;font-size:12px}
  .long{white-space:pre-line;line-height:1.55}
  .tiny{font-size:12px} .muted{color:var(--muted)} .ok{color:var(--ok)} .err{color:var(--err)}
</style>
</head>
<body>
  <div class="wrap">
    <h1>ðŸ”¢ Synchronicity Reader</h1>
    <p class="sub">Enter the exact number you keep seeing. Weâ€™ll map it to your numerology + your tarot/astro sequence.</p>

    <section class="card">
      <div class="row">
        <label>Synchronicity number
          <input id="num" placeholder="e.g., 2011, 2222, 1234" style="min-width:220px">
        </label>
        <button id="analyzeBtn">Analyze</button>
        <button id="copyBtn">Copy reading</button>
        <span id="status" class="tiny muted" style="margin-left:auto"></span>
      </div>
    </section>

    <section class="card" id="resultCard" style="display:none">
      <div class="grid">
        <div class="kpi"><h3>Segments (2â€‘digit)</h3><div id="segments">â€”</div></div>
        <div class="kpi"><h3>Segment Bases</h3><div id="bases">â€”</div></div>
        <div class="kpi"><h3>Final Base</h3><div id="finalBase">â€”</div></div>
      </div>

      <h3 style="margin-top:12px">Tarot & Astro Mapping</h3>
      <div id="chips"></div>

      <h3 style="margin-top:12px">Reading</h3>
      <div id="reading" class="long">â€”</div>
    </section>

    <section class="card tiny muted">
      Uses <code>synchronicity_mapping.json</code> (your mapping) + <code>synchronicity_overrides.json</code> (11/22/33 signs).<br>
      Segments are split leftâ†’right in 2â€‘digit groups (e.g., 2011 â†’ 20, 11). 11/22/33 keep their named energy, but reduce to 2/4/6 for minors & base math.
    </section>
  </div>

<script>
const MAP_URL = 'synchronicity_mapping.json?v='+Date.now();
const OV_URL  = 'synchronicity_overrides.json?v='+Date.now();

const $ = id => document.getElementById(id);
let DB = null, OV = null;

function splitPairsLeft(str){
  // Remove non-digits, then group into two-digit chunks leftâ†’right
  const s = String(str).replace(/\D/g,'');
  if (!s) return [];
  const out = [];
  for (let i=0; i<s.length; i+=2){
    out.push(s.slice(i, i+2));
  }
  return out;
}

function reduceDigit(n){
  n = String(n).replace(/\D/g,'');
  if (!n) return null;
  let sum = 0; for (const ch of n) sum += Number(ch);
  while (sum>9){ let t=0; for (const ch of String(sum)) t += Number(ch); sum=t; }
  return sum;
}

function segmentBase(seg){
  // Master overrides first
  if (OV[seg]) return { base: OV[seg].base, master: seg };
  return { base: reduceDigit(seg), master: null };
}

function mapDigitToEntry(digit){
  // DB uses 0-9 mapping â€” pick matching record or blank
  const rec = (DB && DB[String(digit)]) || null;
  return rec;
}

function unique(arr){ return Array.from(new Set(arr.filter(Boolean))); }

function buildReading(bases, finalBase, signsSet){
  const meaning = {
    1: { theme: "initiative, independence, clean starts", action: "Choose one decisive step and lead with clarity." },
    2: { theme: "cooperation, balance, soft power", action: "Pair up; listen first, align second, act third." },
    3: { theme: "expression, creativity, social links", action: "Speak your idea and invite one ally to riff." },
    4: { theme: "structure, discipline, foundations", action: "Block 30 minutes to systematize one repeating task." },
    5: { theme: "change, movement, flexibility", action: "Simplify, then try a small safe experiment this week." },
    6: { theme: "responsibility, care, harmonizing", action: "Tend to the relationship or space that needs balance." },
    7: { theme: "inner work, analysis, spiritual focus", action: "Take a quiet hour; study one signal without distraction." },
    8: { theme: "power, resources, sustained effort", action: "Commit to a steady 8â€‘day practice toward your goal." },
    9: { theme: "completion, release, service", action: "Close a loop and offer help where it matters most." }
  };
  const pieces = bases.map(b => meaning[b] ? `â€¢ ${b} â†’ ${meaning[b].theme}` : `â€¢ ${b}`).join("\n");
  const finalLine = meaning[finalBase] ? `\nFocus: ${finalBase} â€” ${meaning[finalBase].theme}. ${meaning[finalBase].action}` : '';
  const signLine = signsSet.length ? `\nAstro emphasis: ${signsSet.join(', ')}.` : '';
  return `Segments:\n${pieces}${finalLine}${signLine}`;
}

function analyze(){
  const raw = $('num').value.trim();
  if (!raw){ alert('Enter a number.'); return; }

  const segs = splitPairsLeft(raw);
  const basesInfo = segs.map(s => segmentBase(s));
  const bases = basesInfo.map(x => x.base);
  const finalBase = reduceDigit(bases.reduce((a,b)=>a+b,0));

  // Tarot/Astro chips
  const chipHtml = [];
  const allSigns = [];
  basesInfo.forEach(({base, master}, idx) => {
    const entry = mapDigitToEntry(base) || {};
    const majors = entry.majors || entry.Majors || [];
    const minors = entry.minors || entry.Minors || [];
    const signs  = entry.signs  || entry.Signs  || [];
    const ovSigns = master && OV[master] ? (OV[master].signs||[]) : [];
    const sigs = unique([...(signs||[]), ...ovSigns]);
    allSigns.push(...sigs);

    chipHtml.push(`<div class="chip">Seg ${idx+1}: ${master? master+'â†’':''}${base} Â· ${sigs.join('/')} Â· Majors: ${majors.join(', ')} Â· Minors: ${minors.join(', ')}</div>`);
  });

  const reading = buildReading(bases, finalBase, unique(allSigns));

  // Render
  $('resultCard').style.display = 'block';
  $('segments').textContent = segs.join(', ');
  $('bases').textContent = basesInfo.map(x => (x.master? x.master+'â†’':'') + x.base).join(', ');
  $('finalBase').textContent = String(finalBase);
  $('chips').innerHTML = chipHtml.join('');
  $('reading').textContent = reading;

  $('status').textContent = 'Done';
  setTimeout(()=> $('status').textContent='', 2000);
}

function copyReading(){
  const num = $('num').value.trim();
  const text = [
    'Synchronicity: ' + num,
    'Segments: ' + $('segments').textContent,
    'Base digits: ' + $('bases').textContent,
    'Final base: ' + $('finalBase').textContent,
    '',
    $('reading').textContent,
    '',
    'â€” Spirit Guide App'
  ].join('\n');
  navigator.clipboard.writeText(text).then(()=> alert('Copied reading'));
}

Promise.all([fetch(MAP_URL).then(r=>r.json()).catch(()=>null),
             fetch(OV_URL).then(r=>r.json()).catch(()=>({}))])
  .then(([map, ov]) => {
    // Normalize DB for digits 0-9; support either { "2": {...} } or { numbers: { "2": {...} } }
    DB = (map && (map.numbers || map)) || {};
    OV = ov || {};
    $('status').textContent = 'Ready';
  });

$('analyzeBtn').onclick = analyze;
$('copyBtn').onclick = copyReading;
</script>
</body>
</html>
